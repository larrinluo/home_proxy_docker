# TODO 测试任务清单

## 跨平台兼容性测试

### Linux 环境测试

- [ ] **构建测试**
  - [ ] 在 Ubuntu 20.04/22.04 上运行 `./build.sh`
  - [ ] 在 Ubuntu 20.04/22.04 上运行 `docker build`
  - [ ] 在 Debian 11/12 上运行 `./build.sh`
  - [ ] 验证构建时间和镜像大小

- [ ] **容器运行测试**
  - [ ] 启动容器: `docker-compose up -d`
  - [ ] 检查容器状态: `docker-compose ps`
  - [ ] 检查健康检查: `curl http://localhost:8090/health`
  - [ ] 检查日志: `docker-compose logs -f`

- [ ] **功能测试**
  - [ ] 访问 Web 界面: http://localhost:8090
  - [ ] 用户登录功能
  - [ ] 创建代理服务
  - [ ] 启动代理服务
  - [ ] 停止代理服务
  - [ ] 编辑代理服务
  - [ ] 删除代理服务
  - [ ] PAC 文件生成: `curl http://localhost:8090/proxy.pac`

- [ ] **文件系统测试**
  - [ ] 创建数据文件
  - [ ] 更新数据文件
  - [ ] 检查备份文件生成: `ls -la /data/database/.backup/`
  - [ ] 检查文件权限: `ls -la /data/database/`
  - [ ] 检查文件所有者

- [ ] **权限测试**
  - [ ] 容器内 appuser UID 检查: `docker exec socks-proxy id appuser`
  - [ ] 数据目录权限: `docker exec socks-proxy ls -la /data/`
  - [ ] SSH 密钥目录权限: `docker exec socks-proxy ls -la /data/ssh-keys/`

- [ ] **持久化测试**
  - [ ] 创建数据后重启容器
  - [ ] 验证数据保留
  - [ ] 检查 volume 挂载: `docker inspect socks-proxy`

- [ ] **网络测试**
  - [ ] 端口映射验证 (8090, 11081-11083)
  - [ ] 代理连接测试
  - [ ] SSH 隧道测试

### Windows WSL2 环境测试

- [ ] **构建测试**
  - [ ] 在 WSL2 Ubuntu 上运行 `./build.sh`
  - [ ] 验证构建成功

- [ ] **容器运行测试**
  - [ ] 启动容器: `docker-compose up -d`
  - [ ] 检查容器状态
  - [ ] 检查健康检查

- [ ] **功能测试**
  - [ ] 访问 Web 界面
  - [ ] 创建/编辑/删除代理服务
  - [ ] 启动/停止代理服务

- [ ] **文件系统测试**
  - [ ] 文件创建和更新
  - [ ] 备份文件生成
  - [ ] 文件权限检查

### Windows Docker Desktop 测试

- [ ] **构建测试**
  - [ ] 在 PowerShell 上运行 `./build.sh`
  - [ ] 验证构建成功

- [ ] **容器运行测试**
  - [ ] 启动容器
  - [ ] 检查状态和日志

- [ ] **功能测试**
  - [ ] Web 界面访问
  - [ ] 基本功能测试

---

## 功能回归测试

### 用户认证

- [ ] 用户注册
- [ ] 用户登录
- [ ] 用户登出
- [ ] 会话管理
- [ ] 密码错误处理

### 代理服务管理

- [ ] 创建代理服务
  - [ ] 填写跳板机信息
  - [ ] 选择代理端口
  - [ ] 上传 SSH 密钥
  - [ ] 保存配置

- [ ] 启动代理服务
  - [ ] 启动命令执行
  - [ ] 进程状态更新
  - [ ] 错误处理

- [ ] 停止代理服务
  - [ ] 进程终止
  - [ ] 状态更新
  - [ ] 端口释放

- [ ] 编辑代理服务
  - [ ] 修改配置
  - [ ] 保存更改

- [ ] 删除代理服务
  - [ ] 删除确认
  - [ ] 进程清理
  - [ ] 数据删除

### 主机配置管理

- [ ] 创建主机配置
- [ ] 编辑主机配置
- [ ] 删除主机配置
- [ ] 关联代理服务

### 系统配置

- [ ] 查看系统配置
- [ ] 修改系统配置
- [ ] PAC 配置生成
- [ ] 系统状态查看

### PAC 文件

- [ ] PAC 文件生成
- [ ] PAC 文件访问: `curl http://localhost:8090/proxy.pac`
- [ ] PAC 文件格式验证
- [ ] 多代理规则

---

## 性能测试

### 负载测试

- [ ] **并发写入测试**
  - [ ] 同时创建多个代理服务
  - [ ] 同时更新多个代理服务
  - [ ] 检查数据一致性

- [ ] **大数据量测试**
  - [ ] 创建 100+ 代理服务
  - [ ] 测试列表加载性能
  - [ ] 测试搜索性能

### 文件操作测试

- [ ] **写入性能**
  - [ ] 测试小文件写入 (< 1KB)
  - [ ] 测试中等文件写入 (1KB - 10KB)
  - [ ] 测试大文件写入 (> 10KB)
  - [ ] 测量写入时间

- [ ] **备份性能**
  - [ ] 备份创建速度
  - [ ] 备份文件大小
  - [ ] 磁盘空间使用

---

## 异常场景测试

### 文件系统异常

- [ ] **磁盘空间不足**
  - [ ] 模拟磁盘满
  - [ ] 验证错误处理
  - [ ] 验证用户提示

- [ ] **文件损坏**
  - [ ] 模拟 JSON 文件损坏
  - [ ] 验证恢复逻辑
  - [ ] 测试备份恢复

- [ ] **权限问题**
  - [ ] 数据目录无写权限
  - [ ] SSH 密钥目录权限错误
  - [ ] 验证错误处理

### 网络异常

- [ ] **跳板机不可达**
  - [ ] 无效的 IP 地址
  - [ ] 端口关闭
  - [ ] 验证错误提示

- [ ] **SSH 连接失败**
  - [ ] 认证失败
  - [ ] 密钥错误
  - [ ] 超时

### 进程异常

- [ ] **autossh 进程崩溃**
  - [ ] 模拟进程终止
  - [ ] 验证状态更新
  - [ ] 验证自动恢复

- [ ] **端口冲突**
  - [ ] 端口已被占用
  - [ ] 验证错误提示
  - [ ] 验证端口分配

---

## 数据完整性测试

### 写入完整性

- [ ] **正常写入**
  - [ ] 写入后立即读取验证
  - [ ] 重启后数据验证
  - [ ] 文件内容验证

- [ ] **并发写入**
  - [ ] 两个进程同时写入
  - [ ] 数据一致性检查
  - [ ] 检查数据竞争

### 备份验证

- [ ] **备份创建**
  - [ ] 每次写入都创建备份
  - [ ] 备份文件内容正确
  - [ ] 备份时间戳正确

- [ ] **备份恢复**
  - [ ] 从备份恢复数据
  - [ ] 验证恢复后的数据
  - [ ] 验证备份文件清理

---

## 安全测试

### 权限测试

- [ ] **文件权限**
  - [ ] SSH 密钥文件权限 (600)
  - [ ] SSH 密钥目录权限 (700)
  - [ ] 数据文件权限 (644)

- [ ] **容器权限**
  - [ ] 非 root 用户运行应用
  - [ ] 最小权限原则

### 输入验证

- [ ] **SQL 注入** (如适用)
- [ ] **XSS 防护**
- [ ] **路径遍历**
- [ ] **命令注入**

---

## 兼容性测试

### 浏览器兼容性

- [ ] Chrome/Edge (最新版)
- [ ] Firefox (最新版)
- [ ] Safari (最新版)
- [ ] 移动浏览器

### Node.js 版本

- [ ] Node.js v18.x
- [ ] Node.js v20.x
- [ ] Node.js v22.x

### Docker 版本

- [ ] Docker 20.x
- [ ] Docker 24.x
- [ ] Docker 25.x
- [ ] Docker Desktop for Mac
- [ ] Docker Desktop for Windows

---

## 文档测试

- [ ] **文档完整性**
  - [ ] README.md 准确
  - [ ] CLAUDE.md 完整
  - [ ] FIX_SUMMARY.md 清晰
  - [ ] CROSS_PLATFORM_REVIEW.md 详细

- [ ] **文档可用性**
  - [ ] 新用户可以按文档部署
  - [ ] 命令示例可复制粘贴
  - [ ] 错误信息有帮助

---

## 回归测试

### 之前修复的问题

- [ ] 构建不再卡住
- [ ] npm install 成功
- [ ] 文件写入成功
- [ ] 用户权限正确
- [ ] 健康检查通过

---

## 自动化测试建议

### 单元测试

- [ ] json-store.js 测试
  - [ ] writeTable() 测试
  - [ ] readTable() 测试
  - [ ] 并发测试

### 集成测试

- [ ] API 测试
  - [ ] 认证 API
  - [ ] 代理服务 API
  - [ ] 主机配置 API

### E2E 测试

- [ ] 用户流程测试
  - [ ] 注册到创建代理
  - [ ] 启动到停止代理
